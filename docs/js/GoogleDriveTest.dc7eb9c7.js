(function(){"use strict";var e={3888:function(e,t,n){n(4114);var l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1175),a=l(n(8626)),i=n(9103),c=n(2112);t["default"]=(0,o.defineComponent)({name:"GoogleDrive",setup(){const e="507502242382-a7d868j5089106u313q7hd6js3i375l2.apps.googleusercontent.com",t="https://www.googleapis.com/auth/drive.appdata",n="AIzaSyCMehcHxbFkrej2jq_CT4TuAqQz01MTW6g",l="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",r="appdata_all.json",s=(0,o.ref)(!1);function d(){console.log("initGapiClient"),gapi.client.init({apiKey:n,discoveryDocs:[l]}).then((()=>{s.value=!0}))}(0,o.onMounted)((()=>{const e=document.createElement("script");e.src="https://apis.google.com/js/api.js",e.onload=async function(){gapi.load("client",{callback:function(){d()},onerror:function(){alert("gapi.client failed to load!")},timeout:3e4,ontimeout:function(){alert("gapi.client could not load in a timely manner!")}})},document.body.appendChild(e)}));const u=(0,o.reactive)({}),p=(0,o.reactive)({}),f=(0,o.reactive)({}),m=(0,o.reactive)([]),h=(0,o.reactive)({}),g=(0,o.reactive)({}),b=(0,o.ref)(!1),y=(0,o.computed)((()=>!!u.access_token)),v=(0,o.computed)((()=>{const e=[],t=Object.keys(p).sort(),n=Object.keys(f).sort();return t.forEach((t=>{n.includes(t)?a.default.isEqual(p[t],f[t])?e.push([t,0]):e.push([t,1]):e.push([t,2])})),n.filter((e=>!t.includes(e))).forEach((t=>{e.push([t,3])})),e})),k=(0,o.computed)((()=>0==v.value.filter((e=>0!=e[1])).length)),E=(0,o.computed)((()=>!f||!k.value)),N=(0,o.computed)((()=>f&&!k.value)),V=()=>{(0,i.googleSdkLoaded)((n=>{n.accounts.oauth2.initTokenClient({client_id:e,scope:t,prompt:"",callback:e=>{e.access_token&&(console.log(e),u.access_token=e.access_token,u.expires_in=Number(e.expires_in),u.scope=e.scope,u.token_type=e.token_type,j(),T())}}).requestAccessToken()}))},C=()=>{u.access_token&&(0,i.googleSdkLoaded)((e=>{e.accounts.oauth2.revoke(u.access_token)})),P(u,{}),P(f,{}),m.splice(0,m.length),P(h,{}),P(g,{})},j=async()=>{await B().then((e=>{console.log(e),e?.files&&a.default.isArray(e.files)&&(m.splice(0,m.length,...e.files),console.log(m))})),P(h,{})},w=async e=>{const t=e||m[0].id;await G(t,{alt:"media"}).then((t=>{if(t?.body){const n=JSON.parse(t?.body);P(f,n);const l=m.filter((t=>t.id==e));l.length&&P(g,l[0])}else(0,c.overwriteObject)(g,{})})),T()},O=async e=>{confirm("選択データをGoogle Driveから削除します。よろしいですか？")&&(await I(e),await j(),h&&h.id==e&&(0,c.overwriteObject)(h,{}))},_=async()=>{if(confirm("Google Driveにアプリデータをアップロードします。よろしいですか？")&&(T(),await x(r,p,"application/json"),await j(),m.length>5)){const e=[];for(let t=5;t<m.length;t++)e.push(m[t].id);await Promise.all(e.map((e=>I(e)))),await j()}},S=()=>{confirm("取得済のデータでアプリデータを上書きします。よろしいですか？")&&(P(localStorage,f),T())},T=()=>{P(p,localStorage)},D=async()=>{const e=await B();e?.files&&a.default.isArray(e.files)&&(m.splice(0,m.length,...e.files),await Promise.all(e.files.map((e=>I(e.id)))))},P=(e,t)=>{Object.keys(e).filter((e=>!(e in t))).forEach((t=>{delete e[t]})),Object.keys(t).forEach((n=>{e[n]=t[n]}))};async function x(e,t,n,l){b.value=!0;const o="----====----====----",a={uploadType:"multipart"};l&&Object.keys(l).forEach((e=>{a[e]=l[e]}));const i=[];i.push(["metadata",{name:e,parents:["appDataFolder"]},{"Content-Type":"application/json"}]),i.push(["media",t,{"Content-Type":n}]);try{const e=await gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:a,headers:{"Content-Type":`multipart/related; boundary=${o}`},body:L(i,o)});return console.debug(e),e}catch(c){F(c)}finally{b.value=!1}}function L(e,t){const n=[];return e.forEach((e=>{const l=e[1],o=e[2];n.push(`--${t}`),Object.keys(o).forEach((e=>{n.push(`${e}: ${o[e]}`)})),n.push(""),a.default.isString(l)?n.push(l):a.default.isPlainObject(l)&&n.push(JSON.stringify(l))})),n.push(`--${t}--`),n.join("\r\n")}async function B(e){b.value=!0;const t={orderBy:"modifiedTime desc",pageSize:20,spaces:"appDataFolder",fields:"nextPageToken, files(id, name, modifiedTime, size)"};e&&Object.keys(e).forEach((n=>{t[n]=e[n]}));try{const e=await gapi.client.request({path:"drive/v3/files",method:"GET",params:t});if(console.debug(e),e.result)return e.result;throw e}catch(n){F(n)}finally{b.value=!1}}async function G(e,t){b.value=!0;const n={};t&&Object.keys(t).forEach((e=>{n[e]=t[e]}));try{const t=await gapi.client.request({path:`drive/v3/files/${e}`,method:"GET",params:n});return console.debug(t),t}catch(l){F(l)}finally{b.value=!1}}async function I(e,t){b.value=!0;const n={};t&&Object.keys(t).forEach((e=>{n[e]=t[e]}));try{const t=await gapi.client.request({path:`drive/v3/files/${e}`,method:"DELETE",params:n});return console.debug(t),t}catch(l){F(l)}finally{b.value=!1}}function F(e){console.error(e),alert(e),P(u,{}),P(f,{}),m.splice(0,m.length),P(h,{}),P(g,{})}const M=e=>{const t=[];return h&&h.id==e&&t.push("selected"),g&&g.id==e&&t.push("downloaded"),t.join(" ")};return{login:V,logoff:C,handleListClick:j,handleGetClick:w,handleDeleteClick:O,handleExportClick:_,handleImportClick:S,handleReloadLocalClick:T,handleRemoveAllClick:D,gapiInited:s,isSignedIn:y,isProcessing:b,comparisonList:v,canExport:E,canImport:N,remoteFileList:m,selectedFile:h,downloadedFile:g,loaTrClass:M,overwriteObject:c.overwriteObject}}})},644:function(e,t,n){t.X=void 0;const l=n(1175),o=["disabled"],a=["disabled"],i=["disabled"],c={class:"list-of-appdata"},r=["onClick"],s=["disabled","onClick"],d=["disabled","onClick"],u=["disabled"],p=["disabled"],f={class:"remote-appdata"},m={key:0};function h(e,t,n,h,g,b){return(0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,null,[t[12]||(t[12]=(0,l.createElementVNode)("h2",null,"Google Drive 連携",-1)),t[13]||(t[13]=(0,l.createElementVNode)("h3",null,"テスト中",-1)),t[14]||(t[14]=(0,l.createElementVNode)("p",{style:{"text-align":"left","margin-left":"2rem"}},[(0,l.createElementVNode)("a",{href:"./"},"げんかるく")],-1)),t[15]||(t[15]=(0,l.createElementVNode)("p",null,"本画面では、Google Driveのアプリデータフォルダを介して、ブラウザ間および端末間で《げんかるく》のデータを共有するための機能を提供します。",-1)),t[16]||(t[16]=(0,l.createElementVNode)("div",{class:"usage"},null,-1)),(0,l.createElementVNode)("div",null,[(0,l.createElementVNode)("button",{type:"button",onClick:t[0]||(t[0]=(...t)=>e.login&&e.login(...t)),disabled:!e.gapiInited},(0,l.toDisplayString)(e.isSignedIn?"リフレッシュ":"Googleでログイン"),9,o),(0,l.createElementVNode)("button",{type:"button",onClick:t[1]||(t[1]=(...t)=>e.logoff&&e.logoff(...t)),disabled:!e.isSignedIn||e.isProcessing},"ログアウト",8,a)]),t[17]||(t[17]=(0,l.createElementVNode)("br",null,null,-1)),(0,l.createElementVNode)("div",null,[(0,l.createElementVNode)("button",{type:"button",onClick:t[2]||(t[2]=(...t)=>e.handleListClick&&e.handleListClick(...t)),disabled:!e.isSignedIn||e.isProcessing},"Google Drive上の退避データ一覧を取得",8,i)]),t[18]||(t[18]=(0,l.createElementVNode)("br",null,null,-1)),(0,l.createElementVNode)("table",c,[t[6]||(t[6]=(0,l.createElementVNode)("caption",null,"Google Drive上のアプリデータ",-1)),t[7]||(t[7]=(0,l.createElementVNode)("thead",null,[(0,l.createElementVNode)("tr",null,[(0,l.createElementVNode)("th",null,"name"),(0,l.createElementVNode)("th",null,"modifiedTime"),(0,l.createElementVNode)("th",null,"size"),(0,l.createElementVNode)("th")])],-1)),(0,l.createElementVNode)("tbody",null,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(e.remoteFileList.filter((e=>void 0!==e.id)),(t=>((0,l.openBlock)(),(0,l.createElementBlock)("tr",{class:(0,l.normalizeClass)(e.loaTrClass(t.id)),key:t.id,onClick:n=>e.overwriteObject(e.selectedFile,t)},[(0,l.createElementVNode)("td",null,(0,l.toDisplayString)(t.name),1),(0,l.createElementVNode)("td",null,(0,l.toDisplayString)(t.modifiedTime),1),(0,l.createElementVNode)("td",null,(0,l.toDisplayString)(t.size),1),(0,l.createElementVNode)("td",null,[(0,l.createElementVNode)("button",{type:"button",disabled:e.isProcessing,onClick:n=>e.handleGetClick(t.id)},"取得",8,s),(0,l.createElementVNode)("button",{type:"button",disabled:e.isProcessing,onClick:n=>e.handleDeleteClick(t.id)},"削除",8,d)])],10,r)))),128))])]),t[19]||(t[19]=(0,l.createElementVNode)("br",null,null,-1)),t[20]||(t[20]=(0,l.createElementVNode)("br",null,null,-1)),t[21]||(t[21]=(0,l.createElementVNode)("br",null,null,-1)),(0,l.createElementVNode)("div",null,[(0,l.createElementVNode)("button",{type:"button",onClick:t[3]||(t[3]=(...t)=>e.handleReloadLocalClick&&e.handleReloadLocalClick(...t))},"ローカルデータ再読込"),t[8]||(t[8]=(0,l.createTextVNode)("   ")),(0,l.createElementVNode)("button",{type:"button",onClick:t[4]||(t[4]=(...t)=>e.handleExportClick&&e.handleExportClick(...t)),disabled:!e.canExport||e.isProcessing},"エクスポート",8,u),(0,l.createElementVNode)("button",{type:"button",onClick:t[5]||(t[5]=(...t)=>e.handleImportClick&&e.handleImportClick(...t)),disabled:!e.canImport||e.isProcessing},"インポート",8,p)]),t[22]||(t[22]=(0,l.createElementVNode)("br",null,null,-1)),(0,l.createElementVNode)("table",f,[t[10]||(t[10]=(0,l.createElementVNode)("caption",null," ローカルデータと取得データの差分 ",-1)),t[11]||(t[11]=(0,l.createElementVNode)("thead",null,[(0,l.createElementVNode)("tr",null,[(0,l.createElementVNode)("th",null,"key"),(0,l.createElementVNode)("th",null,"status")])],-1)),(0,l.createElementVNode)("tbody",null,[0==e.comparisonList.filter((e=>0!=e[1])).length?((0,l.openBlock)(),(0,l.createElementBlock)("tr",m,t[9]||(t[9]=[(0,l.createElementVNode)("td",{colspan:"2"},"差分なし",-1)]))):((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,{key:1},(0,l.renderList)(e.comparisonList.filter((e=>0!=e[1])),(e=>((0,l.openBlock)(),(0,l.createElementBlock)("tr",{key:e[0]},[(0,l.createElementVNode)("td",null,(0,l.toDisplayString)(e[0]),1),(0,l.createElementVNode)("td",null,(0,l.toDisplayString)(["同値","差異あり","ローカルのみ","リモートのみ"][e[1]]),1)])))),128))])]),t[23]||(t[23]=(0,l.createElementVNode)("br",null,null,-1)),t[24]||(t[24]=(0,l.createElementVNode)("hr",null,null,-1))],64)}t.X=h},1607:function(e,t,n){var l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1175),a=l(n(6800)),i=l(n(2277));async function c(){(0,o.createApp)(a.default,{}).use(i.default).mount("#app")}c()},6800:function(e,t,n){n.r(t);var l=n(9715),o=n(2775),a={};for(var i in o)"default"!==i&&(a[i]=function(e){return o[e]}.bind(0,i));n.d(t,a);n(5402);var c=n(1241);const r=(0,c.A)(o["default"],[["render",l.X],["__scopeId","data-v-e0566ffc"]]);t["default"]=r},5402:function(){},2775:function(e,t,n){n.r(t),n.d(t,{default:function(){return o.a}});var l=n(3888),o=n.n(l),a={};for(var i in l)"default"!==i&&(a[i]=function(e){return l[e]}.bind(0,i));n.d(t,a)},9715:function(e,t,n){n.d(t,{X:function(){return l.X}});var l=n(644)}},t={};function n(l){var o=t[l];if(void 0!==o)return o.exports;var a=t[l]={id:l,loaded:!1,exports:{}};return e[l].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.m=e,function(){var e=[];n.O=function(t,l,o,a){if(!l){var i=1/0;for(d=0;d<e.length;d++){l=e[d][0],o=e[d][1],a=e[d][2];for(var c=!0,r=0;r<l.length;r++)(!1&a||i>=a)&&Object.keys(n.O).every((function(e){return n.O[e](l[r])}))?l.splice(r--,1):(c=!1,a<i&&(i=a));if(c){e.splice(d--,1);var s=o();void 0!==s&&(t=s)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[l,o,a]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var l in t)n.o(t,l)&&!n.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){n.j=286}(),function(){var e={286:0};n.O.j=function(t){return 0===e[t]};var t=function(t,l){var o,a,i=l[0],c=l[1],r=l[2],s=0;if(i.some((function(t){return 0!==e[t]}))){for(o in c)n.o(c,o)&&(n.m[o]=c[o]);if(r)var d=r(n)}for(t&&t(l);s<i.length;s++)a=i[s],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(d)},l=self["webpackChunkgencalc"]=self["webpackChunkgencalc"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=n.O(void 0,[504,996],(function(){return n(1607)}));l=n.O(l)})();
//# sourceMappingURL=GoogleDriveTest.dc7eb9c7.js.map