(function(){"use strict";var e={3550:function(e,t,n){n.d(t,{$Y:function(){return u},Cb:function(){return A},FX:function(){return w},GN:function(){return M},Ml:function(){return x},Nd:function(){return O},PW:function(){return N},X9:function(){return D},_9:function(){return d},_J:function(){return m},bw:function(){return a},bx:function(){return y},dr:function(){return H},i7:function(){return S},k9:function(){return V},oN:function(){return i},q4:function(){return g},qy:function(){return k},tm:function(){return _},vN:function(){return P}});n(7658);var a=n(8667),s=n(7722),l=n(1930),c=n(7849),r=n(2364),o=n(1003),i=n(5678),u=n(2124),m=n(3185),f=n(8970),d=n(6385),h=n(5093),b=n(9286),p=n(8846),g=n(7646);const y="data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7";function v(e){if(e.icon_url)return e.icon_url;if(e.image)return e.image;if(e.import){let t=e.import.replace("data/","images/");return-1!=t.indexOf("characters/")&&(t=t.replace("characters/","characters/face/")),t=t.replace(/json$/,"png"),t}return null}const k=[];Object.keys(a).forEach((e=>{const t=a[e];t.key=e,t.icon_url=v(t),k.push(t)}));const O={"片手剣":s,"両手剣":l,"長柄武器":c,"弓":r,"法器":o};Object.keys(O).forEach((e=>{const t=O[e];Object.keys(t).forEach((e=>{const n=t[e];n.key=e,n.icon_url=v(n)}))}));Object.keys(s).map((e=>s[e])),Object.keys(l).map((e=>l[e])),Object.keys(c).map((e=>c[e])),Object.keys(r).map((e=>r[e])),Object.keys(o).map((e=>o[e]));const C=[];Object.keys(i).forEach((e=>{const t=i[e];t.key=e,t.icon_url=v(t),C.push(t)}));Object.keys(u[5]),Object.keys(m);for(const W of Object.keys(f))for(const e of Object.keys(f[W]))f[W][e]>=1e3&&(f[W][e]=1/0);const w=Object.keys(f).map((e=>({key:e,...f[e]}))),j=(Object.keys(d).map((e=>({key:e,...d[e]}))),Object.keys(h).map((e=>({key:e,...h[e]}))),Object.keys(b).map((e=>({key:e,...b[e]}))),Object.keys(p).map((e=>({key:e,...p[e]}))),Object.keys(g).map((e=>({key:e,...g[e]}))),new Map);async function _(e){try{if(!j.has(e)){const t=a[e]["import"].replace(/^\//,""),n=await fetch(t).then((e=>e.json())),s=a[e].武器;n.通常攻撃.icon_url=V[s],j.set(e,n)}return j.get(e)}catch(t){throw console.error(e),t}}const E=new Map;async function S(e,t){try{if(!E.has(e)){let n;n=t?[t]:Object.keys(O);for(const t of n)if(e in O[t]){const n=O[t],a=n[e]["import"],s=await fetch(a).then((e=>e.json()));s.種類=t,E.set(e,s);break}}return E.get(e)}catch(n){throw console.error(e,t),n}}const D={"炎":"pyro","水":"hydro","風":"anemo","雷":"electro","草":"dendro","氷":"cryo","岩":"geo"},A={"炎":"pyro-bg","水":"hydro-bg","風":"anemo-bg","雷":"electro-bg","草":"dendro-bg","氷":"cryo-bg","岩":"geo-bg"},M={"炎":"images/element_pyro.png","水":"images/element_hydro.png","風":"images/element_anemo.png","雷":"images/element_electro.png","草":"images/element_dendro.png","氷":"images/element_cryo.png","岩":"images/element_geo.png"},V={"片手剣":"images/characters/NormalAttack_sword.png","両手剣":"images/characters/NormalAttack_claymore.png","長柄武器":"images/characters/NormalAttack_polearm.png","弓":"images/characters/NormalAttack_bow.png","法器":"images/characters/NormalAttack_catalyst.png"},H={1:"star1-bg",2:"star2-bg",3:"star3-bg",4:"star4-bg",5:"star5-bg"},N=new Map([["キャラクター",null],["レベル",null],["命ノ星座",0],["通常攻撃レベル",0],["元素スキルレベル",0],["元素爆発レベル",0],["武器",null],["武器レベル",0],["精錬ランク",0],["聖遺物セット効果1",null],["聖遺物セット効果2",null],["聖遺物メイン効果1",null],["聖遺物メイン効果2",null],["聖遺物メイン効果3",null],["聖遺物メイン効果4",null],["聖遺物メイン効果5",null],["聖遺物サブ効果HP",0],["聖遺物サブ効果攻撃力",0],["聖遺物サブ効果防御力",0],["聖遺物サブ効果元素熟知",0],["聖遺物サブ効果会心率",0],["聖遺物サブ効果会心ダメージ",0],["聖遺物サブ効果元素チャージ効率",0],["聖遺物サブ効果HPP",0],["聖遺物サブ効果攻撃力P",0],["聖遺物サブ効果防御力P",0],["聖遺物優先するサブ効果1",null],["聖遺物優先するサブ効果1上昇値",-1],["聖遺物優先するサブ効果1上昇回数",-1],["聖遺物優先するサブ効果2",null],["聖遺物優先するサブ効果2上昇値",-1],["聖遺物優先するサブ効果2上昇回数",-1],["聖遺物優先するサブ効果3",null],["聖遺物優先するサブ効果3上昇値",-1],["聖遺物優先するサブ効果3上昇回数",-1]]),P=["通常攻撃ダメージ","重撃ダメージ","落下攻撃ダメージ","元素スキルダメージ","元素爆発ダメージ"],I=(new Map([["HP%","HP"],["元素熟知","熟"],["元素チャージ効率","ﾁｬ"],["会心率","率"],["会心ダメージ","ダ"],["与える治療効果","治"]]),new Map([["HP%","HP"],["攻撃力%","AT"],["防御力%","DF"],["元素熟知","EM"],["会心率","CR"],["会心ダメージ","CD"],["元素チャージ効率","ER"],["与える治療効果","HE"],["炎元素ダメージバフ","Py"],["水元素ダメージバフ","Hy"],["風元素ダメージバフ","An"],["雷元素ダメージバフ","El"],["草元素ダメージバフ","De"],["氷元素ダメージバフ","Cr"],["岩元素ダメージバフ","Ge"],["物理ダメージバフ","Ph"]]),new Map([["HP","HP"],["攻撃力","ATK"],["防御力","DEF"],["元素熟知","ElementalMastery"],["会心率","CritRate"],["会心ダメージ","CritDMG"],["元素チャージ効率","EnergyRecharge"],["炎元素ダメージバフ","Pyro"],["水元素ダメージバフ","Hydro"],["風元素ダメージバフ","Anemo"],["雷元素ダメージバフ","Electro"],["草元素ダメージバフ","Dendro"],["氷元素ダメージバフ","Cryo"],["岩元素ダメージバフ","Geo"],["物理ダメージバフ","Physical"],["与える治療効果","Healing"],["HP%","HPp"],["攻撃力%","ATKp"],["防御力%","DEFp"]])),T=new Map;I.forEach(((e,t)=>{T.set(e,t)}));const x=[{key:"",values:[7,7,7],counts:[0,0,0]},{key:"厳選初心者",values:[3,3,3],counts:[7,4,4]},{key:"厳選1ヶ月",values:[3,3,3],counts:[8,5,5]},{key:"厳選3ヶ月",values:[3,3,3],counts:[11,8,7]},{key:"日々石割り",values:[1,1,1],counts:[14,11,10]}]},9192:function(e,t,n){var a=n(9242),s=n(3396),l=n(7139);const c=e=>((0,s.dD)("data-v-452af94c"),e=e(),(0,s.Cn)(),e),r={class:"base-container"},o={class:"pane1"},i={class:"display-stat-select"},u=["value"],m={class:"number-of-teams"},f=["min"],d={class:"data-control"},h=["disabled"],b={class:"pane2"},p={class:"pane3"},g=c((()=>(0,s._)("hr",null,null,-1))),y=(0,s.uE)('<div class="pane4" data-v-452af94c></div><div class="footer" data-v-452af94c><hr data-v-452af94c><h2 data-v-452af94c>チーム編成 Ver.0.1.2</h2><ul class="usage" data-v-452af94c><li data-v-452af94c>右上の◆のドラッグ＆ドロップでチームの並べ替えができます。</li></ul><p data-v-452af94c><a href="./" data-v-452af94c>げんかるく - 原神ダメージシミュレーター</a>   <a href="./TeamOptionList.html" data-v-452af94c>強化・弱体効果一覧</a></p></div>',2);function v(e,t,n,c,v,k){const O=(0,s.up)("TeamItem"),C=(0,s.up)("draggable"),w=(0,s.up)("CharacterSelectModal"),j=(0,s.up)("TeamRotation");return(0,s.wg)(),(0,s.iD)("div",r,[(0,s._)("div",o,[(0,s._)("fieldset",null,[(0,s._)("div",i,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.DISPLAY_STAT_LIST,(n=>((0,s.wg)(),(0,s.iD)("label",{class:"display-stat",key:n[1]},[(0,s.wy)((0,s._)("input",{class:"hidden",type:"radio",name:"display-stat","onUpdate:modelValue":t[0]||(t[0]=t=>e.displayStat=t),value:n[0]},null,8,u),[[a.G2,e.displayStat]]),(0,s._)("span",null,(0,l.zw)(n[1]),1)])))),128))]),(0,s._)("label",m,[(0,s.Uk)(" Number of teams "),(0,s.wy)((0,s._)("input",{type:"number",min:e.NUMBER_OF_TEAMS,"onUpdate:modelValue":t[1]||(t[1]=t=>e.numberOfTeams=t),onChange:t[2]||(t[2]=(...t)=>e.numberOfTeamsOnChange&&e.numberOfTeamsOnChange(...t))},null,40,f),[[a.nr,e.numberOfTeams]])]),(0,s._)("div",d,[(0,s._)("button",{type:"button",disabled:e.saveDisabled,onClick:t[3]||(t[3]=(...t)=>e.saveOnClick&&e.saveOnClick(...t))}," Save ",8,h),(0,s._)("button",{type:"button",onClick:t[4]||(t[4]=(...t)=>e.clearOnClick&&e.clearOnClick(...t))},"Clear")])])]),(0,s._)("div",b,[(0,s.wy)((0,s._)("div",null,[(0,s.Wm)(C,{list:e.teams,"item-key":"id",sort:!0,handle:".handle"},{item:(0,s.w5)((({element:t})=>[(0,s.Wm)(O,{team:t,selected:e.teamSelected(t.id),displayStat:e.displayStat,onClick:n=>e.teamOnClick(t.id),"onChange:name":e.teamNameOnChange,"onChange:buildname":e.buildnameOnChange,"onClick:character":n=>e.characterOnClick(t)},null,8,["team","selected","displayStat","onClick","onChange:name","onChange:buildname","onClick:character"])])),_:1},8,["list"])],512),[[a.F8,!e.characterSelectVisible]]),(0,s.wy)((0,s._)("div",null,[(0,s.Wm)(w,{visible:e.characterSelectVisible,members:e.forcusedMembers,"onClick:cancel":t[5]||(t[5]=t=>e.characterSelectVisible=!1),"onClick:ok":e.updateCharacters},null,8,["visible","members","onClick:ok"])],512),[[a.F8,e.characterSelectVisible]])]),(0,s._)("div",p,[g,e.teams[e.selectedTeamId]?((0,s.wg)(),(0,s.j4)(j,{key:0,team:e.teams[e.selectedTeamId]},null,8,["team"])):(0,s.kq)("",!0)]),y])}n(7658);var k=n(4806),O=n.n(k),C=n(6983),w=n.n(C),j=n(4870),_=n(589),E=n(2986),S=n(3550);const D=10,A=4;function M(e){let t;return e.name&&e.name in S.bw&&(t=S.bw[e.name]),t}function V(e){const t=e.split("_"),n=t[1];let a;return t.splice(0,2),a=t.length>0?t.join("_"):(0,E.K1)(n),a}function H(e){return Object.keys(localStorage).filter((t=>t.startsWith((0,E.R4)(e))))}function N(e,t){let n;const a=(0,E.R4)(e,t),s=localStorage.getItem(a);return s&&(n=JSON.parse(s)),n}const P={class:"title"},I={class:"name"},T=(0,s._)("span",{class:"handle"},"◆",-1),x={key:0},W={key:1},q={class:"elemental-resonance"},F=["src"],L={class:"members"};function R(e,t,n,c,r,o){const i=(0,s.up)("MemberItem");return(0,s.wg)(),(0,s.iD)("div",{class:(0,l.C_)("team"+e.selectedClass)},[(0,s._)("div",P,[(0,s._)("label",I,[T,e.editable?((0,s.wg)(),(0,s.iD)("span",x,[(0,s.wy)((0,s._)("input",{type:"text",minlength:"1",maxlength:"16","onUpdate:modelValue":t[0]||(t[0]=t=>e.name=t),placeholder:"INPUT TEAM NAME",onChange:t[1]||(t[1]=(...t)=>e.nameOnChange&&e.nameOnChange(...t))},null,544),[[a.nr,e.name]]),(0,s._)("span",{class:"button material-symbols-outlined",onClick:t[2]||(t[2]=t=>e.editable=!1)}," edit_off ")])):((0,s.wg)(),(0,s.iD)("span",W,[(0,s._)("span",null,(0,l.zw)(e.name),1),(0,s._)("span",{class:"button material-symbols-outlined",onClick:t[3]||(t[3]=t=>e.editable=!0)}," edit ")]))]),(0,s._)("div",q,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.resonanceElementImgSrcs,(e=>((0,s.wg)(),(0,s.iD)("img",{class:"elemental-resonance",key:e,src:e,alt:"resonance"},null,8,F)))),128))])]),(0,s._)("div",L,[(0,s._)("table",null,[(0,s._)("tr",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.team.members,(t=>((0,s.wg)(),(0,s.iD)("td",{key:t.id},[(0,s.Wm)(i,{member:t,statsObj:e.memberStats[t.id],displayStat:e.displayStat,showEquipment:!0,viewable:!0,members:e.team.members.map((e=>e.name)),elementalResonance:e.elementalResonance,"onClick:character":e.characterOnClick,"onChange:buildname":e.changeBuildname},null,8,["member","statsObj","displayStat","members","elementalResonance","onClick:character","onChange:buildname"])])))),128))])])])],2)}const B={class:"member"},U={class:"with-tooltip"},z=["src","alt"],Y={class:"tooltip"},Z=["src"],K={key:0,class:"tag tag-3"},$={key:1,class:"tag tag-2"},G={key:2,class:"tag tag-1"},X={key:3,class:"tag tag-0"},J={key:0,class:"stat-value"},Q={key:1},ee=["src"],te=["src"],ne=["src"],ae={class:"extra-control"},se={key:0};function le(e,t,n,c,r,o){return(0,s.wg)(),(0,s.iD)("div",B,[(0,s._)("div",{class:"member-img",onClick:t[0]||(t[0]=(...t)=>e.characterOnClick&&e.characterOnClick(...t))},[(0,s._)("div",U,[(0,s._)("img",{class:(0,l.C_)("character"+e.characterImgClass),src:e.characterImgSrc,alt:e.displayName(e.member.name)},null,10,z),(0,s._)("span",Y,(0,l.zw)(e.displayName(e.member.name)),1)]),(0,s._)("img",{class:"vision",src:e.visionImgSrc,alt:"vision"},null,8,Z),(0,s.wy)((0,s._)("div",{class:"constellation"},(0,l.zw)(e.constellation),513),[[a.F8,e.constellation]]),e.member.tags[3]?((0,s.wg)(),(0,s.iD)("div",K,(0,l.zw)(e.member.tags[3]),1)):(0,s.kq)("",!0),e.member.tags[2]?((0,s.wg)(),(0,s.iD)("div",$,(0,l.zw)(e.member.tags[2]),1)):(0,s.kq)("",!0),e.member.tags[1]?((0,s.wg)(),(0,s.iD)("div",G,(0,l.zw)(e.member.tags[1]),1)):(0,s.kq)("",!0),e.member.tags[0]?((0,s.wg)(),(0,s.iD)("div",X,(0,l.zw)(e.member.tags[0]),1)):(0,s.kq)("",!0)]),e.displayStat?((0,s.wg)(),(0,s.iD)("div",J,(0,l.zw)(e.statValue),1)):(0,s.kq)("",!0),e.showEquipment?((0,s.wg)(),(0,s.iD)("div",Q,[(0,s._)("img",{class:"weapon",src:e.imgWeaponSrc,alt:"weapon"},null,8,ee),(0,s._)("img",{class:"artifact-set",src:e.imgArtifactSetSrc(0),alt:"artifact-set"},null,8,te),(0,s._)("img",{class:"artifact-set",src:e.imgArtifactSetSrc(1),alt:"artifact-set"},null,8,ne)])):(0,s.kq)("",!0),(0,s._)("div",ae,[e.viewable&&"locate"==e.extraControl?((0,s.wg)(),(0,s.iD)("div",se,[(0,s._)("button",{type:"button",onClick:t[1]||(t[1]=(...t)=>e.locate&&e.locate(...t))},"view")])):(0,s.kq)("",!0)])])}var ce=(0,s.aZ)({name:"MemberItem",props:{member:{type:Object,required:!0},statsObj:{type:Object},displayStat:{type:String},showEquipment:{type:Boolean},viewable:{type:Boolean},tags:{type:Array},members:{type:Array},elementalResonance:{type:Array}},emits:["click:character","change:buildname"],setup(e,t){const{displayName:n,displayStatValue:a}=(0,_.Z)(),l=(0,j.iH)("locate"),c=(0,j.iH)(0);(0,s.YP)(e,(()=>{c.value++}));const r=(0,s.Fl)((()=>e.member.name?S.bw[e.member.name]??void 0:void 0)),o=(0,s.Fl)((()=>r.value?.icon_url??S.bx)),i=(0,s.Fl)((()=>{const e=r.value?.レアリティ;return e?" "+S.dr[String(e)]:""})),u=(0,s.Fl)((()=>r.value?.元素?S.GN[r.value.元素]:S.bx)),m=(0,s.Fl)((()=>f.value?f.value.命ノ星座:"")),f=(0,s.Fl)((()=>{let t;const n=e.member.name;return n&&e.member.buildname&&(t=N(n,e.member.buildname)),t})),d=(0,s.Fl)((()=>{let e;if(f.value){const t=f.value.武器;t&&r.value&&(e=S.Nd[r.value.武器][t])}return e})),h=(0,s.Fl)((()=>d.value?d.value.icon_url:S.bx)),b=(0,s.Fl)((()=>d.value?d.value.key:"")),p=(0,s.Fl)((()=>{const e=[];if(f.value)for(let t=0;t<2;t++){const n="聖遺物セット効果"+(t+1);let a=f.value[n]??"NONE";e.push(S.oN[a])}return e})),g=e=>p.value[e]?.image??S.bx,y=e=>p.value[e]?.key??"",v=()=>{t.emit("click:character")},k=(0,s.Fl)((()=>{c.value;let t="-";if(f.value){let n=e.displayStat;e.statsObj&&n&&("会心率/ダメージ"===n?(t=a("会心率",e.statsObj["会心率"]),t+="/",t+=a("会心ダメージ",e.statsObj["会心ダメージ"])):t=a(n,e.statsObj[n]))}return t})),O=()=>{const t=e.member,n=e.members?.filter((e=>e!=t.name));console.warn(e.members,n),(0,E.Ac)(t.name,t.buildname,void 0,n),window.open("./","_blank")};return{displayName:n,characterImgSrc:o,characterImgClass:i,visionImgSrc:u,constellation:m,imgWeaponSrc:h,weaponName:b,imgArtifactSetSrc:g,artifactSetName:y,statValue:k,extraControl:l,locate:O,characterOnClick:v}}}),re=n(89);const oe=(0,re.Z)(ce,[["render",le]]);var ie=oe,ue=n(5983);function me(e,t){return t+E.iU[e][0]==t?"+":""}function fe(e,t,n){if(!e)return 0;const a=me(t,n);if(a in e)return e[a];const s=E.iU[t][0],l=E.iU[t][E.iU[t].length-1],c=e[s+"+"],r=e[l];return c+(r-c)*(n-s)/(l-s)}function de(e,t){const n=E.iU[t][0];return e[n+"+"]}function he(e,t){if(e in t)return t[e];e=Number(e);const n=Object.keys(t).map((e=>Number(e)));let a,s;for(let l=0;l<n.length-1;l++)n[l]<=e&&n[l+1]>=e&&(a=n[l],s=n[l+1]);return a&&s?t[a]+(t[s]-t[a])*(e-a)/(s-a):0}function be(e,t){Object.keys(e).forEach((t=>{e[t]=0}));for(const n of t){if(!n)continue;const t=n.split("_");e[t[1]]+=S.$Y[t[0]][t[1]]}}function pe(e){const t=e.聖遺物ステータス,n=e.聖遺物ステータスメイン効果,a=e.聖遺物ステータスサブ効果;for(const s of Object.keys(t))t[s]=0;for(const s of Object.keys(n))s in t?t[s]+=n[s]:t[s]=n[s];for(const s of Object.keys(a))s in t?t[s]+=a[s]:t[s]=a[s]}const ge=function(e,t,n,a,s){if(t&&n&&a&&s)try{const l=t.characterMaster,c=t.突破レベル,r=t.レベル,o=t.命ノ星座,i=t.weaponMaster,u=t.武器突破レベル,m=t.武器レベル,f=O().cloneDeep(E.q2);if(f["突破レベル"]=c,f["レベル"]=r,f["命ノ星座"]=o,f["元素"]=l.元素,"元素エネルギー"in l["元素爆発"]&&(f["元素エネルギー"]=l["元素爆発"]["元素エネルギー"]),"固有変数"in l)for(const e of Object.keys(l["固有変数"]))e in a.conditionValues?f[e]=Number(a.conditionValues[e]):f[e]=l["固有変数"][e];for(const t of Object.keys(e.enemyMaster).filter((e=>"key"!=e))){const n="敵"+t;f[n]=e.enemyMaster[t]}Object.keys(e.statAdjustments).filter((e=>!E.PL.includes(e))).forEach((t=>{t in f&&(f[t]+=e.statAdjustments[t])})),Object.keys(e.statAdjustmentsEx).filter((e=>!E.PL.includes(e))).forEach((t=>{t in f&&(f[t]+=e.statAdjustmentsEx[t])}));for(const e of Object.keys(l["ステータス"]))if(E.Vd.includes(e))f[e]+=fe(l["ステータス"][e],c,r);else{const t=["HP","攻撃力","防御力"].includes(e)?e+"+":e;t in f&&(f[t]+=de(l["ステータス"][e],c))}for(const e of Object.keys(i["ステータス"]))f[e]+=fe(i["ステータス"][e],u,m);const d=n.聖遺物ステータス;for(const e of Object.keys(d)){const t=["HP","攻撃力","防御力"].includes(e)?e+"+":e;f[t]+=d[e]}let h="法器"==l.武器?l.元素:"物理",b="法器"==l.武器?l.元素:"物理",p="法器"==l.武器?l.元素:"物理";s&&[s.elementalResonance,s.teamOption,s.miscOption].forEach((e=>{e&&e.conditionAdjustments&&Object.keys(e.conditionAdjustments).forEach((t=>{const n=e.conditionAdjustments[t];if(n===1/0){if(t.endsWith("元素付与")&&["片手剣","両手剣","長柄武器"].includes(l.武器)){const e=t.replace(/元素付与$/,"");h=e,b=e,p=e}}else if(null!==n&&(t in f?f[t]+=n:f[t]=n,t.endsWith("V1")||t.endsWith("V2")||t.endsWith("V3"))){const e=t.replace(/V[1-3]$/,"");e in f?f[e]+=n:f[e]=n}}))}));const g=we(a);Fe(f,s),E.PL.forEach((t=>{t in e.statAdjustments&&t in f&&(f[t]+=e.statAdjustments[t])}));const y=ye(t,g,f);for(const e of[t.damageDetailMyCharacter,t.damageDetailMyWeapon,t.damageDetailMyArtifactSets])if(e&&E.yL in e)for(const t of e[E.yL]){if(t["条件"]){const e=je(t["条件"],g,o);if(0==e)continue}if(t["種類"]&&t["種類"].endsWith("元素付与")){const e=t["種類"].replace("元素付与","");t["対象"]?"通常攻撃ダメージ"==t["対象"]?h=e:"重撃ダメージ"==t["対象"]?b=e:"落下攻撃ダメージ"==t["対象"]&&(p=e):(h=e,b=e,p=e)}}a.攻撃元素=[h,b,p],(0,ue.fX)(e.statsObj,f),(0,ue.fX)(a.conditionAdjustments,y)}catch(l){console.error(l),console.error(e,t,n,a,s)}};function ye(e,t,n){const a=e.命ノ星座,s={},l=new Map;for(const m of[e.damageDetailMyCharacter,e.damageDetailMyWeapon,e.damageDetailMyArtifactSets])if(m&&E.e2 in m)for(const e of m[E.e2]){let n=!1,s=e["数値"];if(e["条件"]){const l=je(e.条件,t,a);if(0==l)continue;1!=l&&(s=s.concat(["*",l])),n=!0}let c=e["種類"];c&&(e["対象"]&&(c+="."+e["対象"]),l.has(c)||l.set(c,[]),l.get(c)?.push([c,s,e.上限,e.下限,n]))}const c=["基礎HP","HP%","HP+","HP上限"],r=["基礎防御力","防御力%","防御力+","防御力"],o=["基礎攻撃力","攻撃力%","攻撃力+","攻撃力"],i=[...E.U3,...E.tH,...E.Em,...E.wB,...E.uc,"ダメージ軽減"];i.push(...Array.from(l.keys()).filter((e=>-1!=e.indexOf("ダメージバフ.")))),i.push(...Array.from(l.keys()).filter((e=>-1!=e.indexOf("ダメージアップ."))));const u=[...new Set(Array.from(l.keys()).map((e=>e.replace(/V[1-3]$/,""))))].filter((e=>![...c,...r,...o,...i].includes(e)));u.sort(ke);for(const m of c){const e={};["V1","V2","V3"].forEach((t=>{const a=m+t;e[a]=a in n?n[a]:0})),ve(s,n,l,m),["V1","V2","V3"].forEach((t=>{const a=m+t;n[a]&&(m in n?n[m]+=n[a]-e[a]:n[m]=n[a]-e[a])}))}n["HP上限"]+=n["基礎HP"]+n["HP+"],n["HP上限"]+=n["基礎HP"]*n["HP%"]/100;for(const m of u){const e={};["V1","V2","V3"].forEach((t=>{const a=m+t;e[a]=a in n?n[a]:0})),ve(s,n,l,m),["V1","V2","V3"].forEach((t=>{const a=m+t;n[a]&&(m in n?n[m]+=n[a]-e[a]:n[m]=n[a]-e[a])}))}for(const m of r){const e={};["V1","V2","V3"].forEach((t=>{const a=m+t;e[a]=a in n?n[a]:0})),ve(s,n,l,m),["V1","V2","V3"].forEach((t=>{const a=m+t;n[a]&&(m in n?n[m]+=n[a]-e[a]:n[m]=n[a]-e[a])}))}n["防御力"]+=n["基礎防御力"]+n["防御力+"],n["防御力"]+=n["基礎防御力"]*n["防御力%"]/100;for(const m of o){const e={};["V1","V2","V3"].forEach((t=>{const a=m+t;e[a]=a in n?n[a]:0})),ve(s,n,l,m),["V1","V2","V3"].forEach((t=>{const a=m+t;n[a]&&(m in n?n[m]+=n[a]-e[a]:n[m]=n[a]-e[a])}))}n["攻撃力"]+=n["基礎攻撃力"]+n["攻撃力+"],n["攻撃力"]+=n["基礎攻撃力"]*n["攻撃力%"]/100;for(const m of i){const e={};["V1","V2","V3"].forEach((t=>{const a=m+t;e[a]=a in n?n[a]:0})),ve(s,n,l,m),["V1","V2","V3"].forEach((t=>{const a=m+t;n[a]&&(m in n?n[m]+=n[a]-e[a]:n[m]=n[a]-e[a])}))}return s}function ve(e,t,n,a){for(const s of[n.get(a),...["V1","V2","V3"].map((e=>n.get(a+e)))])s&&s.forEach((n=>{const a=We(t,n[0],n[1],n[2],n[3]);for(const e of Object.keys(a))if(E.PL.includes(e+"TOP")){const n=(0,E.A2)(e+"X7",t),a=t[e+"TOP"];void 0!==n&&void 0!==a&&n>a&&(t[e+"TOP"]=n)}if(n[4])for(const t of Object.keys(a))t in e?e[t]+=a[t]:e[t]=a[t]}))}function ke(e,t){const n=["元素熟知","会心率","会心ダメージ","与える治療効果","受ける治療効果","元素チャージ効率","シールド強化"],a=["ダメージ軽減"];let s=n.indexOf(e);a.indexOf(e)>=0&&(s=n.length+1);let l=n.indexOf(t);return a.indexOf(t)>=0&&(l=n.length+1),(-1!=s?s:n.length)-(-1!=l?l:n.length)}function Oe(e,t,n,a=null,s=null){try{let l=0;if(Array.isArray(e)){let c=null;for(const r of e){let o=0;if(["+","-","*","/"].includes(r))c=r;else{if((0,ue.hj)(r))o=Number(r);else if(Array.isArray(r))o=Oe(r,t,n);else if(-1!=r.indexOf("#")){const l=r.split("#");if(n&&l[0]in n){const c=n[l[0]];let i=null;for(const e of c)if(l[1]==e[0]){i=e[4];break}null!=i?o=i:console.error(e,t,n,a,s,r)}}else{const n=(0,E.A2)(r,t);void 0===n?console.error(e,t,null,a,s):o=n}if(null==c)l+=o;else switch(c){case"+":l+=o;break;case"-":l-=o;break;case"*":l*=o,l=Math.floor(100*l)/100;break;case"/":l/=o;break}}}}else if((0,ue.hj)(e))l=Number(e);else{const n=(0,E.A2)(e,t);void 0!==n?l=n:(console.error(e,t,null,a,s),l=0)}if(null!=a){const e=Oe(a,t,n);l=Math.min(l,e)}if(null!=s){const e=Oe(s,t,n);l=Math.max(l,e)}return l}catch(l){throw console.error(l),console.error(e,t,n,a,s),l}}function Ce(e,t,n,a){try{if(!t)return;if(!n)return;if(!a)return;const s=t.characterMaster,l=t["命ノ星座"],c=s["元素"],r=O().cloneDeep(E.vo),o=[[c,S.q4[c]]];if(n.selectList.filter((e=>"元素変化"==e.name)).length){const e=n.selectList.filter((e=>"元素変化"==e.name))[0],t=n.conditionValues["元素変化"];if(t){const n=e.options[t].replace(/元素$/,"");o.push([n,S.q4[n]])}}if(n.selectList.filter((e=>"拡散"==e.name)).length){const e=n.selectList.filter((e=>"拡散"==e.name))[0],t=n.conditionValues["拡散"];if(t){const n=e.options[t].replace(/元素$/,"");o.push([n,S.q4[n]])}}r["元素"]=c,o.forEach((e=>{const t=e[0],s=e[1];Object.keys(s).forEach((e=>{const l=s[e];let c=0;if("結晶"==e)c=De(t,a.statsObj);else if("拡散"==e){let s="炎";for(const e of n.selectList)if("拡散"==e.name){const t=e.options[Number(n.conditionValues["拡散"])];t&&(s=t.replace(/元素$/,""));break}r["拡散元素"]=s,c=Se(e,t,a.statsObj,s)}else switch(l["種類"]){case"乗算":c=Ee(e,t,a.statsObj);break;case"固定":c=Se(e,t,a.statsObj);break;case"加算":c=Ae(e,t,a.statsObj);break}["倍率","ダメージ","吸収量"].forEach((t=>{const n=e+t;n in r&&(r[n]=c)}))}))})),Object.keys(r).filter((e=>e.endsWith("ダメージ")&&-1==e.indexOf("会心"))).forEach((e=>{["会心率","会心ダメージ"].forEach((t=>{const n=e+t;n in a.statsObj&&(r[n]=a.statsObj[n])}))})),(0,ue.fX)(e.元素反応,r),console.debug("元素反応",e.元素反応);const i=we(n),u=t.damageDetailMyCharacter,m=t.damageDetailMyWeapon,f=t.damageDetailMyArtifactSets;if(Array.isArray(e["キャラクター注釈"])&&e["キャラクター注釈"].splice(0,e["キャラクター注釈"].length),u){for(const s of["通常攻撃","重撃","落下攻撃"]){if(e[s]=[],!(s in u))continue;const c=n.攻撃元素[["通常攻撃","重撃","落下攻撃"].indexOf(s)];let r=u[s];if("特殊"+s in u){const e=u["特殊"+s];0!=je(e["条件"],i,l)&&(r=e["詳細"])}for(const o of r){if(o["条件"]&&0==je(o["条件"],i,l))continue;const r=Ne(o,t,n,a.statsObj,e,c);e[s].push(r)}if("通常攻撃"==s){let t=0;const n=["合計ダメージ",null,0,0,0,null,0,0,1];for(const a of e[s])!a[0].endsWith("段ダメージ")&&!["水月ダメージ"].includes(a[0])||a[0].startsWith("非表示_")||(n[1]=a[1],n[2]+=a[2],null==a[3]?n[3]=null:null!=n[3]&&(n[3]+=a[3]),n[4]+=a[4],null!=n[6]&&(a[6]?n[6]+=a[6]:n[6]++),n[7]=a[7],n[8]=a[8],t++);t>0&&e[s].splice(t,0,n)}}for(const s of["元素スキル","元素爆発","その他"]){if(e[s]=[],!(s in u))continue;const c=u[s];for(const r of c){if(r["条件"]&&0==je(r["条件"],i,l))continue;const c=Ne(r,t,n,a.statsObj,e);e[s].push(c)}}}for(const b of[m,f]){const s="その他";if(!b||!(s in b))continue;const c=b[s];for(const r of c){if(r["条件"]&&0==je(r["条件"],i,l))continue;const c=Ne(r,t,n,a.statsObj,e);e[s].push(c)}}const d=[];for(const e of E.tH){const t=e.replace(/元素耐性$/,"").replace(/耐性$/,""),n=qe(a.statsObj,1e4,t);d.push({key:t,value:n})}e["被ダメージ"]=d;const h=[];for(const e of d)h.push({key:e.key,value:1e4*a.statsObj["HP上限"]/e.value});e["耐久スコア"]=h,console.debug(e)}catch(s){console.error(s),console.error(e,t,n,a)}}function we(e){try{const t=[];if(!e)return t;const n=e.checkboxList;n&&n.forEach((n=>{e.conditionValues[n.name]&&t.push(n.name)}));const a=e.selectList;a&&a.forEach((n=>{const a=e.conditionValues[n.name];void 0!==a&&null!==a&&(a>0||0==a&&n.required)&&t.push(n.name+"@"+n.options[a])}));const s=e.numberList;return s&&s.forEach((n=>{const a=e.conditionValues[n.name];void 0!==a&&null!==a&&t.push(n.name+"="+a)})),t}catch(t){throw console.error(t),console.error(e),t}}function je(e,t,n){const a=e.split("^")[0];if(-1!=a.indexOf("|")){const e=a.split("|");for(let a=0;a<e.length;a++){const s=_e(e[a],t,n);if(1==s)return 1}return 0}const s=a.split("&");let l=1;for(let c=0;c<s.length;c++){const e=_e(s[c],t,n);if(0==e)return 0;1!=e&&(l=e)}return l}function _e(e,t,n){const a=e.split(/[@=]/);if("命ノ星座"==a[0]){if(2==a.length&&(0,ue.hj)(a[1])){const e=Number(a[1]);if(e<=n)return 1}return 0}if(t.includes(e)||t.includes(e.replace("=","@")))return 1;if(1==a.length)return t.filter((t=>t.split("@")[0]==e)).length>0?1:0;if(-1!=e.indexOf("=")){if(E.r2.test(a[1])){const e=t.filter((e=>e.split("=")[0]==a[0]));if(e.length>0)return Number(e[0].split("=")[1])}return 0}const s=new RegExp("[^0-9]*?([\\-0-9\\.]+).*");for(let l=0;l<t.length;l++)if(t[l].startsWith(a[0]+"@")){const e=t[l].split("@"),n=s.exec(e[1]);if(n){const e=Number(n[1]);return e}}return 0}function Ee(e,t,n){try{if(!t||"物理"==t)return 0;const a=n["元素熟知"],s=n[e+"反応ボーナス"]??0;let l=S.q4[t][e]["数値"];return l*=1+25*a/(9*(a+1400))+s/100,l}catch(a){throw console.error(a),console.error(e,t,n),a}}function Se(e,t,n,a){try{if(!t||"物理"==t)return 0;const s=n["レベル"],l=n["元素熟知"],c=n[e+"反応ボーナス"]??0,r=a??S.q4[t][e]["元素"];let o=he(s,S.q4[t][e]["数値"]);return o*=1+16*l/(l+2e3)+c/100,o*=He(r,n),o}catch(s){throw console.error(s),console.error(e,t,n,a),s}}function De(e,t){try{if(!e||"物理"==e)return 0;const n=t["レベル"],a=t["元素熟知"],s=t["結晶反応ボーナス"]??0;let l=he(n,S.q4[e]["結晶"]["数値"]);return l*=1+40*a/(9*(a+1400))+s/100,l}catch(n){throw console.error(n),console.error(e,t),n}}function Ae(e,t,n){try{if(!t||"物理"==t)return 0;const a=n["レベル"],s=n["元素熟知"],l=n[e+"反応ボーナス"]??0,c=S.q4[t][e]["元素"];let r=he(a,S.q4[t][e]["数値"]);return r*=1+5*s/(s+1200)+l/100,r*=He(c,n),r}catch(a){throw console.error(a),console.error(e,t,n),a}}function Me(e,t=0){try{const n=e["レベル"]??0,a=e["敵レベル"]??0,s=t/100,l=Math.max(-100,e["敵防御力"]??0)/100,c=(n+100)/((1-s)*(1+l)*(a+100)+n+100);return c}catch(n){throw console.error(n),console.error(e,t),n}}function Ve(e){if(e==1/0)return 0;let t=e;return t=t<0?100-t/2:t<75?100-t:1e4/(4*t+100),t/=100,t}function He(e,t){try{const n="敵"+e+("物理"!=e?"元素":"")+"耐性",a=Ve(t[n]??0);return a}catch(n){throw console.error(n),console.error(e,t),n}}function Ne(e,t,n,a,s,l=null){try{const c=[];let r=!0,o=!0,i=!0,u=null!=e["元素"]?e["元素"]:null!=l?l:null,m=0,f=0;const d=null!=e["HIT数"]?Number(e["HIT数"]):1,h={},b=a["命ノ星座"],p=Ie(t,E.yL);let g=we(n);const y=O().cloneDeep(n.conditionValues);if(e["除外条件"])for(const t of e["除外条件"]){let e=t;O().isPlainObject(t)&&(e=t.名前),e in y&&((0,ue.hj)(y[e])?y[e]=0:O().isBoolean(y[e])&&(y[e]=!1))}if(e["適用条件"])for(const t of e["適用条件"])if(O().isString(t))t in y&&O().isBoolean(y[t])&&(y[t]=!0);else if(O().isPlainObject(t)){if(t.名前 in y){let e=y[t.名前];if("数値"in t){if(O().isString(t.数値)){const n=String(t.数値).replace(/^\+/,"");e+=Number(n)}else e=((0,ue.hj)(t.数値),t.数値);null!==e&&(0,ue.hj)(e)&&(e<0?e=0:n.selectList.filter((e=>e.name==t.名前)).forEach((t=>{null!==e&&e>=t.options.length&&(e=t.options.length-1)})))}else e=!0;y[t.名前]=e}if(t.説明)if(Array.isArray(t.説明))t.説明.forEach((e=>{s["キャラクター注釈"].includes(e)||s["キャラクター注釈"].push(e)}));else{const e=t.説明;s["キャラクター注釈"].includes(e)||s["キャラクター注釈"].push(e)}}if(e["除外条件"]||e["適用条件"]){const e=O().cloneDeep(n);e.conditionValues=y;const l=we(e);[t.damageDetailMyCharacter,t.damageDetailMyWeapon,t.damageDetailMyArtifactSets].forEach((e=>{e&&e.ステータス変更系詳細.filter((e=>e.条件)).forEach((e=>{const t=e.条件;let n=0,c=0;const r=je(t,g,b),o=je(t,l,b);if(r==o)return;if(0!=r){let t=e.数値;1!=r&&(t=t.concat(["*",r])),n=Oe(t,a,s,e.上限,e.下限)}if(0!=o){let t=e.数値;1!=o&&(t=t.concat(["*",o])),c=Oe(t,a,s,e.上限,e.下限)}const i=c-n;if(i){let t=e.種類;e.対象&&(t+="."+e.対象),t in h?h[t]+=i:h[t]=i}}))})),g=l}const v=[];p&&p.forEach((t=>{let n=null;if(!t.条件||(n=je(t.条件,g,b),0!=n)){if(t.対象)if(t.対象.endsWith("元素ダメージ")){if(!t.対象.startsWith(u))return}else if("物理ダメージ"==t.対象){if("物理"!=u)return}else{const n=e.種類,a=t.対象.split(".");if(a[0]!=n)return;if(a.length>1&&a[a.length-1]!=e.名前)return}if(t["種類"].endsWith("元素付与"))["通常攻撃ダメージ","重撃ダメージ","落下攻撃ダメージ"].includes(e.種類)&&(e["元素付与無効"]||(u=t["種類"].replace("元素付与","")));else if("防御無視"==t.種類){const e=Oe(t.数値,a,s,t.上限,t.下限);m+=e}else if("固有変数"==t.種類);else if(null!=n&&1!=n){const e=JSON.parse(JSON.stringify(t));e.数値=e.数値.concat(["*",n]),v.push(e)}else v.push(t)}})),console.debug(e["名前"]+":myTalentChangeDetailObjArr"),console.debug(v);const k={};[a,h].forEach((t=>{Object.keys(t).forEach((n=>{const a=n.split(".");if(1==a.length)return;let s=!1;if(a[1]==e.種類?(2==a.length||a[2]==e.名前&&3==a.length)&&(s=!0):a[1]==u+"元素ダメージ"?2==a.length&&(s=!0):"物理ダメージ"==a[1]&&"物理"==u&&2==a.length&&(s=!0),s){const e=a[0];e in k?"別枠乗算"==e&&k[e]>0?k[e]*=t[n]/100:k[e]+=t[n]:k[e]=t[n]}}))})),Object.keys(k).forEach((e=>{e in h?e.startsWith("別枠乗算")&&h[e]>0?h[e]*=k[e]/100:h[e]+=k[e]:h[e]=k[e]})),console.debug("myステータス補正",h);const C=t.damageDetailMyArtifactSets;if(C&&"通常攻撃ダメージ"==e.種類&&e.HIT数>1&&"来歆の余響"==t.artifactSets[0]&&"来歆の余響"==t.artifactSets[1]){let t=!1;for(const n of C[E.e2].filter((e=>e.条件&&e.種類&&e.数値))){const l=n.種類,c=n.条件,r=e.HIT数;if(0!=je(c,g,b)){const e=Oe(n.数値,a,s,n.上限,n.下限);l in h||(h[l]=0),h[l]-=e*(r-Math.max(1,Math.floor(r/2)))/r,t=!0}}if(t){const e="来歆の余響4セット効果の幽谷祭祀のダメージアップは多段HITダメージの全てには乗らない。3HIT以下：1回分、4HIT：2回分を計上する";s["キャラクター注釈"].includes(e)||s["キャラクター注釈"].push(e)}}switch(Object.keys(h).forEach((e=>{e in a?e.startsWith("別枠乗算")&&a[e]>0?a[e]*=h[e]:a[e]+=h[e]:a[e]=h[e],console.debug("ステータス補正",e,h[e])})),a["別枠乗算"]&&(f=a["別枠乗算"]),e.種類){case"HP回復":c.push("与える治療効果"),c.push("受ける治療効果"),r=!1,o=!1,i=!1,u=null;break;case"シールド":c.push("シールド強化"),r=!1,o=!1,i=!1;break;case"元素創造物HP":r=!1,o=!1,i=!1,u=null;break;case"他所基準ダメージ":o=!1,i=!1;break;case"他所基準HP回復":r=!1,o=!1,i=!1,u=null;break;case"付加元素ダメージ":["炎","水","雷","氷"].includes(u)||(u="炎");break;default:e.種類.startsWith("表示")||e.種類.startsWith("非表示")?(r=!1,o=!1,i=!1,u=null):(c.push("与えるダメージ"),"NONE"!=e.ダメージバフ&&(e.ダメージバフ?c.push(e.ダメージバフ):S.vN.includes(e.種類)&&c.push(e.種類+"バフ")),u&&c.push("物理"==u?"物理ダメージバフ":u+"元素ダメージバフ"));break}const w=Pe(a,s,e.数値,c,r,o,i,u,m,f,e.上限,e.下限);if(v.forEach((t=>{const n=Pe(a,s,t.数値,c,r,o,i,u,m,null,t.上限,t.下限);if(t.種類.endsWith("ダメージアップ")){if("ダメージアップ"==e.名前)return;S.vN.includes(e.種類)&&d>1&&(n[2]*=d,null!=n[3]&&(n[3]*=d),n[4]*=d)}w[2]+=n[2],null!=w[3]&&n[3]&&(w[3]+=n[3]),w[4]+=n[4]})),[...S.vN,"その他ダメージ"].includes(e.種類)){let t=e.種類;if(e.ダメージバフ){const n=e.ダメージバフ.replace(/バフ$/,"");S.vN.includes(n)&&(t=n)}const n=[];n.push(t+"アップ"),u&&n.push("物理"==u?"物理ダメージアップ":u+"元素ダメージアップ"),n.forEach((t=>{if(!a[t])return;if(!o||!i)return;if(e.名前.startsWith("非表示_狼の魂基礎"))return;const n=Pe(a,s,a[t],c,r,o,i,u,m,null);d>1&&(n[2]*=d,null!=n[3]&&(n[3]*=d),n[4]*=d),w[2]+=n[2],null!=w[3]&&n[3]&&(w[3]+=n[3]),w[4]+=n[4]}))}Object.keys(h).forEach((e=>{a[e]-=h[e]})),"シールド"==e.種類&&"岩"==w[1]&&(w[2]=1.5*w[2],w[4]=1.5*w[4]);const j=[e.名前,w[1],w[2],w[3],w[4],e.種類,e.HIT数,w[7],w[8]];return console.debug("calculateDamageFromDetail",e,t,n,a,l,j),j}catch(c){throw console.error(c),console.error(e,t,n,a,l),c}}function Pe(e,t,n,a,s,l,c,r,o,i,u=null,m=null){const f=Oe(n,e,t,u,m);let d=f;i?d*=i/100:i=1,Te(n)&&(a=null,l=!1,c=!1);let h=1;a&&(h=100,a.forEach((t=>{e[t]&&(h+=e[t])})),h/=100,d*=h);let b=1;l&&(b=Me(e,o),d*=b);let p=1;c&&r&&(p=He(r,e),d*=p);let g=e["会心率"];"物理"==r?"物理ダメージ会心率"in e&&(g+=e["物理ダメージ会心率"]):r+"元素ダメージ会心率"in e&&(g+=e[r+"元素ダメージ会心率"]),g=Math.min(100,Math.max(0,g))/100;let y=e["会心ダメージ"];"物理"==r?"物理ダメージ会心ダメージ"in e&&(y+=e["物理ダメージ会心ダメージ"]):r+"元素ダメージ会心ダメージ"in e&&(y+=e[r+"元素ダメージ会心ダメージ"]),y=(100+y)/100;let v=null,k=d;return s&&g>0&&(v=d*y,k=v*g+d*(1-g)),console.debug("%f * %f * [%o]=%f * [%f,%f] * %f * %f => %f,%f,%f",f,i,a,h,g,y,b,p,k,v,d),["未設定",r,k,v,d,null,null,h,b]}function Ie(e,t){let n=[];return e?(e.damageDetailMyCharacter&&t in e.damageDetailMyCharacter&&(n=n.concat(e.damageDetailMyCharacter[t])),e.damageDetailMyWeapon&&t in e.damageDetailMyWeapon&&(n=n.concat(e.damageDetailMyWeapon[t])),e.damageDetailMyArtifactSets&&t in e.damageDetailMyArtifactSets&&(n=n.concat(e.damageDetailMyArtifactSets[t])),n):n}function Te(e){if(!Array.isArray(e))return!(0,ue.hj)(e)&&-1!=String(e).indexOf("#");let t=!1;return e.forEach((e=>{["+","-","*","/"].includes(String(e))||(0,ue.hj)(e)||(Array.isArray(e)?Te(e)&&(t=!0):-1!=String(e).indexOf("#")&&(t=!0))})),t}const xe=["炎","水","風","雷","草","氷","岩"];function We(e,t,n,a=null,s=null){const l=Oe(n,e,E.US,a,s);(0,ue.hj)(l)||console.error(e,t,n,l);const c=[];"HP"==t?c.push("HP上限"):t.startsWith("自元素")?c.push(t.replace(/^自/,String(e["元素"]))):t.startsWith("全元素")?xe.forEach((e=>{c.push(t.replace(/^全/,e))})):t.startsWith("敵自元素")?c.push(t.replace(/^敵自/,"敵"+String(e["元素"]))):t.startsWith("敵全元素")?xe.forEach((e=>{c.push(t.replace(/^敵全/,"敵"+e))})):c.push(t);const r={};c.forEach((e=>{r[e]=l}));for(const o of Object.keys(r))o in e?o.startsWith("別枠乗算")&&r[o]>0?e[o]*=r[o]/100:e[o]+=r[o]:e[o]=r[o];return console.debug(We.name,null,t,n,"=>",r),r}function qe(e,t,n){const a=e["防御力"],s=e["敵レベル"],l=e["ダメージ軽減"],c=Ve(e["物理"==n?"物理耐性":n+"元素耐性"]);let r=t*(1-a/(a+5*s+501))*(100-l)/100*c;return r=Math.max(0,r),r}function Fe(e,t){E.PL.forEach((n=>{const a=n.replace(/TOP$/,"X7");let s=(0,E.A2)(a,e);s&&(e[n]=s);for(const l of t.teamMembers){const c=t.supporters[l];c?.statsInput?.statsObj&&(s=(0,E.A2)(a,c.statsInput.statsObj),void 0!==s&&e[n]<s&&(e[n]=s))}}))}const Le=["過負荷ダメージ","感電ダメージ","超電導ダメージ","拡散ダメージ","燃焼ダメージ","開花ダメージ","烈開花ダメージ","超開花ダメージ"],Re=new Map;function Be(){Le.forEach((e=>{const t=e.replace(/ダメージ$/,"");Object.keys(S.q4).forEach((n=>{const a=S.q4[n],s=Object.keys(a);s.includes(t)&&"元素"in a[t]&&Re.set(e,a[t].元素)}))}))}Be();var Ue=(0,s.aZ)({name:"TeamItem",props:{team:{type:Object,required:!0},selected:{type:Boolean,requied:!0},displayStat:{type:String}},emits:["change:name","click:character","change:buildname"],components:{MemberItem:ie},setup(e,t){const{displayName:n}=(0,_.Z)(),a=(0,j.qj)({}),l=(0,j.iH)(0);(0,s.YP)(e,(async e=>{o.value=e.team.name;const t=[];for(const a of e.team.members)t.push(f(a).then((e=>({key:a.id,value:e}))));const n={};await Promise.all(t).then((e=>{e.forEach((e=>{a[e.key]=e.value.statsInput?.statsObj;const t=e.value.characterInput?.characterMaster,s=e.value.characterInput?.weaponMaster;if(t&&t.チームバフ)for(const a of t.チームバフ){if(a.条件)continue;const t=Oe(a.数値,e.value.statsInput.statsObj,e.value.damageResult,a.最大値,a.最小値);a.種類 in n?n[a.種類]+=t:n[a.種類]=t}if(s&&s.チームバフ)for(const a of s.チームバフ){if(a.条件)continue;const t=Oe(a.数値,e.value.statsInput.statsObj,e.value.damageResult,a.最大値,a.最小値);a.種類 in n?n[a.種類]+=t:n[a.種類]=t}}))}));for(const s of Object.keys(n))for(const e of Object.keys(a))a[e]&&(s in a[e]?a[e][s]+=n[s]:a[e][s]=n[s]);l.value++}));const c=(0,s.Fl)((()=>e.selected?" selected":"")),r=(0,j.iH)(!1),o=(0,j.iH)(e.team.name),i=()=>{t.emit("change:name",e.team.id,o)},u=(0,s.Fl)((()=>{const t=[],n={},a=e.team.members.filter((e=>e.name));return 4==a.length&&(a.forEach((e=>{const t=M(e);t&&(t.元素 in n?n[t.元素]++:n[t.元素]=1)})),4==Object.keys(n).length?t.push("元素共鳴なし"):Object.keys(n).forEach((e=>{n[e]>=2&&t.push(e+"元素共鳴")}))),t})),m=(0,s.Fl)((()=>{const t=[];return u.value.forEach((n=>{if("元素共鳴なし"==n){const n=e.team.members.filter((e=>e.name));n.forEach((e=>{const n=S.bw[e.name],a=S.GN[n.元素];t.push(a)}))}else{const e=S.GN[n.replace("元素共鳴","")];t.push(e),t.push(e)}})),t})),f=async t=>{const n=O().cloneDeep(E.Hd),a=O().cloneDeep(E.HN),s=O().cloneDeep(E.NY),l=O().cloneDeep(E.wX),c=O().cloneDeep(E.HO),r=O().cloneDeep(E.US),o={characterInput:n,artifactDetailInput:a,conditionInput:s,optionInput:l,statsInput:c,damageResult:r};if(!t.name)return o;let i;n.character=t.name,n.characterMaster=await(0,S.tm)(n.character);const m=t.name;if(m&&t.buildname&&(i=N(m,t.buildname)),!i)return o;await(0,E.pS)(n,a,s,l,i),(0,E.ge)(n),(0,E.Cl)(n),(0,E.Vk)(n),(0,E.Hk)(s,n,l),be(a.聖遺物ステータスメイン効果,a.聖遺物メイン効果),pe(a),s.checkboxList.forEach((e=>{s.conditionValues[e.name]=!1})),s.selectList.forEach((e=>{s.conditionValues[e.name]=0}));const f=n.characterMaster.元素,d={};if(e.team.members&&e.team.members.filter((e=>e.name)).forEach((e=>{const t=S.bw[e.name].元素;t in d?d[t]++:d[t]=1})),["千岩古剣","千岩長槍"].includes(n.weapon)){if(e.team.members){let t=0;for(const n of e.team.members.filter((e=>e))){const e=await(0,S.tm)(n.name);e.region&&["璃月港"].includes(e.region)&&t++}const a="["+n.weapon+"]璃月キャラ1人毎に攻撃力と会心率+";s.conditionValues[a]=t}}else if(["惡王丸","斬波のひれ長","曚雲の月"].includes(n.weapon)&&e.team.members){let t=0;for(const n of e.team.members.filter((e=>e))){const e=await(0,S.tm)(n.name);"元素エネルギー"in e.元素爆発&&(t+=e.元素爆発.元素エネルギー)}t&&(s.conditionValues["チーム全員の元素エネルギー上限の合計"]=t)}const h=d[f]-1,b=Object.keys(d).filter((e=>e!=f)),p=b.length?b.map((e=>d[e])).reduce(((e,t)=>e+t)):0;if(s.conditionValues["[チーム]同じ元素のキャラクター"]=h,s.conditionValues["[チーム]異なる元素のキャラクター"]=p,s.conditionValues["[チーム]キャラクターの元素タイプ"]=Object.keys(d).length-1,xe.forEach((e=>{const t="[チーム]"+e+"元素キャラクター";s.conditionValues[t]=d[e]??0;const n="[チーム]"+e+"元素キャラクター(自分以外)";s.conditionValues[n]=(d[e]??0)-(e==f?1:0)})),u.value){const e={};u.value.filter((e=>["炎元素共鳴","水元素共鳴","草元素共鳴","元素共鳴なし"].includes(e))).forEach((t=>{if(l.elementalResonance.conditionValues[t]=!0,"詳細"in S._9[t]){const n=S._9[t].詳細;if(n)for(const t of n)"種類"in t&&"数値"in t&&(t.種類 in e?e[t.種類]+=t.数値:e[t.種類]=t.数値)}})),(0,ue.fX)(l.elementalResonance.conditionAdjustments,e)}return ge(c,n,a,s,l),Ce(r,n,s,c),{characterInput:n,artifactDetailInput:a,conditionInput:s,optionInput:l,statsInput:c,damageResult:r}},d=()=>{t.emit("click:character")},h=(n,a)=>{t.emit("change:buildname",e.team.id,n,a)};return{displayName:n,selectedClass:c,editable:r,name:o,memberStats:a,elementalResonance:u,resonanceElementImgSrcs:m,nameOnChange:i,characterOnClick:d,changeBuildname:h}}});const ze=(0,re.Z)(Ue,[["render",R]]);var Ye=ze;const Ze=e=>((0,s.dD)("data-v-6d52d41d"),e=e(),(0,s.Cn)(),e),Ke=Ze((()=>(0,s._)("hr",null,null,-1))),$e={class:"tags"},Ge=["onClick"],Xe={class:"buildname-select"},Je=["value"],Qe={class:"buttons"};function et(e,t,n,c,r,o){const i=(0,s.up)("CharacterSelect"),u=(0,s.up)("MemberItem");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(i,{visible:!0,characters:e.characters,"onUpdate:characters":e.updateCharacters},null,8,["characters","onUpdate:characters"]),Ke,(0,s._)("div",$e,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.TAG_LIST,(t=>((0,s.wg)(),(0,s.iD)("span",{class:"tag",key:t,onClick:n=>e.tagOnClick(t)},(0,l.zw)(t),9,Ge)))),128))]),(0,s._)("div",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.workMembers,(t=>((0,s.wg)(),(0,s.iD)("div",{class:(0,l.C_)("member"+e.memberSelectedClass(t.id)),key:t.id},[(0,s.Wm)(u,{member:t,onClick:n=>e.memberOnClick(t.id)},null,8,["member","onClick"])],2)))),128)),(0,s._)("div",Xe,[(0,s.wy)((0,s._)("select",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.selectedMemberBuildname=t),onChange:t[1]||(t[1]=(...t)=>e.buildnameOnChange&&e.buildnameOnChange(...t))},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.buildnames,(e=>((0,s.wg)(),(0,s.iD)("option",{key:e,value:e},(0,l.zw)(e),9,Je)))),128))],544),[[a.F8,e.buildnames.length],[a.bM,e.selectedMemberBuildname]])])]),(0,s._)("div",Qe,[(0,s._)("button",{type:"button",onClick:t[2]||(t[2]=(...t)=>e.cancelOnClick&&e.cancelOnClick(...t))},"cancel"),(0,s._)("button",{type:"button",onClick:t[3]||(t[3]=(...t)=>e.okOnClick&&e.okOnClick(...t))},"ok")])],64)}var tt=n(7229),nt=(0,s.aZ)({name:"CharacterSelectModal",components:{CharacterSelect:tt.Z,MemberItem:ie},props:{visible:{type:Boolean,required:!0},members:{type:Array,required:!0}},emits:["click:cancel","click:ok"],setup(e,t){const n=(0,j.qj)([]),a=(0,j.iH)(-1),l=["FREE"],c=(0,j.iH)("");function r(){const t=[];for(let n=0;n<e.members.length;n++)t.push({id:n,name:e.members[n].name,buildname:e.members[n].buildname,builddata:e.members[n].builddata,tags:O().cloneDeep(e.members[n].tags)});n.splice(0,n.length,...t)}r(),(0,s.YP)(e,(e=>{e.members&&(r(),a.value>=0&&a.value<n.length&&(c.value=n[a.value].buildname))}));const o=(0,s.Fl)((()=>n.map((e=>e.name)))),i=e=>{for(let t=0;t<e.length;t++)if(n[t].name=e[t],n[t].name){const e=H(n[t].name).map((e=>V(e)));e.length?(n[t].buildname&&e.includes(n[t].buildname)||(n[t].buildname=(0,E.K1)(n[t].name)),t==a.value&&(c.value=n[t].buildname)):n[t].buildname=void 0}},u=e=>{if(a.value=e,a.value>=0&&a.value<n.length){const e=n[a.value];c.value=e.buildname}},m=e=>e==a.value?" selected":"",f=e=>{if(a.value<0||a.value>=n.length)return;const t=n[a.value];if(console.log(e,t),t&&t.name){const n=t.tags;n&&(n.includes(e)?n.splice(0,n.length,...n.filter((t=>t!=e))):n.push(e))}},d=(0,s.Fl)((()=>{let e=[];if(a.value>=0&&a.value<n.length){const t=n[a.value],s=t.name;if(s){e=H(s).map((e=>V(e)));const t=(0,E.K1)(s);if(e.includes(t)){const n=e.filter((e=>e!=t)).sort();n.length&&(e=[t,...n])}}}return e})),h=()=>{if(a.value<0||a.value>=n.length)return;const e=n[a.value];e.buildname=c.value},b=()=>{t.emit("click:cancel")},p=()=>{t.emit("click:ok",n)};return{characters:o,TAG_LIST:l,tagOnClick:f,workMembers:n,memberOnClick:u,memberSelectedClass:m,selectedMemberBuildname:c,buildnames:d,buildnameOnChange:h,updateCharacters:i,cancelOnClick:b,okOnClick:p}}});const at=(0,re.Z)(nt,[["render",et],["__scopeId","data-v-6d52d41d"]]);var st=at;const lt={class:"team-rotation"},ct={class:"icon-list"},rt={key:0,class:"action with-tooltip"},ot=["src","alt","onClick"],it={class:"tooltip"},ut={key:1,class:"action with-tooltip"},mt=["src","alt","onClick"],ft={class:"tooltip"},dt={class:"rotation-list"},ht={class:"index"},bt=["src","alt"],pt=["src","alt"],gt={class:"information"},yt={class:"control"},vt=["onClick"];function kt(e,t,n,a,c,r){const o=(0,s.up)("draggable");return(0,s.wg)(),(0,s.iD)("div",lt,[(0,s._)("fieldset",ct,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.team.members,(t=>((0,s.wg)(),(0,s.iD)(s.HY,{key:t.id},[e.getElementalSkillDetail(t)?((0,s.wg)(),(0,s.iD)("div",rt,[(0,s._)("img",{class:"action-icon",src:e.getElementalSkillDetail(t).icon_url,alt:e.displayName(e.getElementalSkillDetail(t).名前),onClick:n=>e.actionOnClick(t,"E")},null,8,ot),(0,s._)("span",it,(0,l.zw)(e.displayName(t.name))+" "+(0,l.zw)(e.displayName("元素スキル")),1)])):(0,s.kq)("",!0),e.getElementalBurstDetail(t)?((0,s.wg)(),(0,s.iD)("div",ut,[(0,s._)("img",{class:"action-icon",src:e.getElementalBurstDetail(t).icon_url,alt:e.displayName(e.getElementalBurstDetail(t).名前),onClick:n=>e.actionOnClick(t,"Q")},null,8,mt),(0,s._)("span",ft,(0,l.zw)(e.displayName(t.name))+" "+(0,l.zw)(e.displayName("元素爆発")),1)])):(0,s.kq)("",!0)],64)))),128))]),(0,s._)("fieldset",dt,[(0,s.Wm)(o,{list:e.rotationList,"item-key":"id",sort:!0,handle:".handle"},{item:(0,s.w5)((({element:t,index:n})=>[e.actionDetail(t)?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,l.C_)("rotation-item"+e.colorClass(t.member))},[(0,s._)("span",ht,(0,l.zw)(("00"+(n+1)).slice(-2)),1),(0,s._)("img",{class:"character-icon handle",src:e.getCharacterMaster(t.member).icon_url,alt:e.displayName(t.member)},null,8,bt),(0,s._)("img",{class:(0,l.C_)("action-icon handle"+e.bgColorClass(t.member)),src:e.actionDetail(t).icon_url,alt:e.displayName(e.actionDetail(t).名前)},null,10,pt),(0,s._)("span",null,(0,l.zw)(e.displayName(e.actionDetail(t).名前)),1),(0,s._)("div",gt,(0,l.zw)(e.actionEnergyFluctuation(t)),1),(0,s._)("div",yt,[(0,s._)("button",{type:"button",onClick:n=>e.removeItemOnClick(t)},"×",8,vt)])],2)):(0,s.kq)("",!0)])),_:1},8,["list"])])])}let Ot=0;var Ct=(0,s.aZ)({name:"TeamRotation",components:{draggable:w()},props:{team:{type:Object,required:!0}},setup(e){const{displayName:t}=(0,_.Z)(),n=new Map,a=(0,j.qj)([]),l=(0,j.iH)(0);(0,s.YP)(e,(async()=>{if(e.team){for(const t of e.team.members)if(t.name){const e=await(0,S.tm)(t.name);n.set(t.name,e)}a.splice(0,a.length),l.value++}}));const c=e=>S.bw[e],r=e=>(l.value,n.get(e)??void 0),o=e=>{const t=r(e.name);return t?t.元素スキル:void 0},i=e=>{const t=r(e.name);return t?t.元素爆発:void 0},u=e=>{const t=c(e);return t?" "+S.X9[t.元素]:""},m=e=>{const t=c(e);return t?" "+S.Cb[t.元素]:""},f=(e,t)=>{a.push({id:++Ot,member:e.name,action:t})},d=e=>{let t;const n=r(e.member);return n&&(t=e.action.startsWith("E")?n.元素スキル:"Q"==e.action?n.元素爆発:void 0),t},h=e=>{let t="";const n=r(e.member),a=d(e);return n&&a&&(a.名前==n.元素スキル.名前?t="":a.名前==n.元素爆発.名前&&(t+=a.元素エネルギー?"-"+a.元素エネルギー:"")),t},b=e=>{a.splice(0,a.length,...a.filter((t=>t!=e)))};return{displayName:t,colorClass:u,bgColorClass:m,getCharacterMaster:c,getElementalSkillDetail:o,getElementalBurstDetail:i,actionOnClick:f,rotationList:a,getCharacterDetail:r,actionDetail:d,actionEnergyFluctuation:h,removeItemOnClick:b}}});const wt=(0,re.Z)(Ct,[["render",kt]]);var jt=wt;let _t=1;var Et=(0,s.aZ)({name:"TeamManager",components:{draggable:w(),TeamItem:Ye,CharacterSelectModal:st,TeamRotation:jt},setup(){const{displayName:e}=(0,_.Z)(),t=(0,j.iH)(!1),n=(0,j.iH)(D),a=[["","None"],["レベル","Lv."],["HP上限","Max HP"],["攻撃力","ATK"],["防御力","DEF"],["元素熟知","EM"],["会心率/ダメージ","CRIT"],["元素チャージ効率","ER"]],l=(0,j.iH)(""),c=(0,j.iH)(0),r=e=>e==c.value;function o(e){return{id:e,name:"",buildname:void 0,builddata:void 0,tags:[]}}function i(e){const t={id:e,name:"チーム"+(e+1),members:[]};for(let n=0;n<A;n++)t.members.push(o(_t++));return t}function u(e){e.name="",e.buildname=void 0,e.builddata=void 0}function m(e){e.name="チーム"+(e.id+1),e.members.forEach((e=>{u(e)}))}const f=(0,j.qj)([]);for(let s=0;s<n.value;s++)f.push(i(s));const d=e=>{c.value=e},h=e=>{c.value==e&&(t.value=!0),c.value=e},b=()=>{f.forEach((e=>{m(e)}))},p=(0,s.Fl)((()=>{const e=O().cloneDeep(f);return e.forEach((e=>{e.members.forEach((e=>{e.builddata=void 0}))})),JSON.stringify(e)})),g=(0,j.iH)(""),y=()=>{localStorage.setItem("teams",p.value),g.value=p.value},v=(0,s.Fl)((()=>p.value==g.value)),k=()=>{if(n.value>f.length)for(let e=f.length;e<n.value;e++)f.push(i(e));else n.value<f.length&&(c.value>n.value&&(c.value=0),f.splice(n.value))},C=()=>{const e=localStorage.getItem("teams");if(e){const t=JSON.parse(e);n.value=t.length,k();for(let e=0;e<f.length;e++){const n=f[e];if(t[e]){n.name=t[e].name;const a=n.members;for(let n=0;n<a.length;n++)t[e].members[n]&&(a[n].name=t[e].members[n].name,t[e].members[n].buildname?a[n].buildname=t[e].members[n].buildname:a[n].buildname=void 0,a[n].builddata=void 0,t[e].members[n].tags?a[n].tags=t[e].members[n].tags:a[n].tags=[])}}}};C();const w=(0,s.Fl)((()=>f.filter((e=>e.id==c.value))[0].members??[])),E=e=>{if(-1!=c.value){const t=f.filter((e=>e.id==c.value))[0];if(t){const n=[];for(let a=0;a<e.length;a++){const s=o(t.members[a].id);s.name=e[a].name,s.buildname=e[a].buildname,s.builddata=void 0,s.tags.splice(0,s.tags.length,...e[a].tags),n.push(s)}t.members.splice(0,t.members.length,...n)}}t.value=!1},S=e=>{r(e.id)?t.value=!0:c.value=e.id},M=(e,t)=>{const n=f.filter((t=>t.id==e))[0];n&&(n.name=t)},V=(e,t,n)=>{const a=f.filter((t=>t.id==e))[0];if(a){const e=a.members.filter((e=>e.id==t))[0];e&&(e.buildname=n)}};return{displayName:e,characterSelectVisible:t,NUMBER_OF_TEAMS:D,NUMBER_OF_MEMBERS:A,numberOfTeams:n,numberOfTeamsOnChange:k,DISPLAY_STAT_LIST:a,displayStat:l,clearOnClick:b,saveOnClick:y,loadOnClick:C,saveDisabled:v,selectedTeamId:c,teamSelected:r,teams:f,forcusedMembers:w,teamOnClick:d,characterOnClick:S,memberOnClick:h,updateCharacters:E,teamNameOnChange:M,buildnameOnChange:V}}});const St=(0,re.Z)(Et,[["render",v],["__scopeId","data-v-452af94c"]]);var Dt=St,At=n(2540);async function Mt(){(0,a.ri)(Dt,{}).use(At.Z).mount("#app")}Mt()}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var l=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(l.exports,l,l.exports,n),l.loaded=!0,l.exports}n.m=e,function(){var e=[];n.O=function(t,a,s,l){if(!a){var c=1/0;for(u=0;u<e.length;u++){a=e[u][0],s=e[u][1],l=e[u][2];for(var r=!0,o=0;o<a.length;o++)(!1&l||c>=l)&&Object.keys(n.O).every((function(e){return n.O[e](a[o])}))?a.splice(o--,1):(r=!1,l<c&&(c=l));if(r){e.splice(u--,1);var i=s();void 0!==i&&(t=i)}}return t}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[a,s,l]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){n.j=299}(),function(){var e={299:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var s,l,c=a[0],r=a[1],o=a[2],i=0;if(c.some((function(t){return 0!==e[t]}))){for(s in r)n.o(r,s)&&(n.m[s]=r[s]);if(o)var u=o(n)}for(t&&t(a);i<c.length;i++)l=c[i],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(u)},a=self["webpackChunkgencalc"]=self["webpackChunkgencalc"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998,64],(function(){return n(9192)}));a=n.O(a)})();
//# sourceMappingURL=TeamManager.5f4a4b7a.js.map